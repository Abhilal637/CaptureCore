<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shop | CaptureCore</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 font-sans">
    <%- include('../partial/user/navbar') %>

    <!-- Page title -->
    <section class="text-center py-16">
      <h2 class="text-4xl font-light tracking-wide mb-2">SHOP</h2>
      <p class="text-sm text-gray-500">Home / Shop</p>
    </section>

    <!-- Products and Sidebar -->
    <div class="container mx-auto px-6 grid grid-cols-4 gap-8">
      <!-- Sidebar -->
      <aside class="col-span-1 space-y-6">
        <div>
          <h3 class="font-semibold mb-2">CATEGORIES</h3>
          <ul class="text-sm text-gray-600 space-y-1">
            <li>
              <a href="/shop" class="<%= !query.category ? 'text-blue-600 font-medium' : 'hover:text-blue-600' %>">
                All Categories
              </a>
            </li>
            <% categories.forEach(category => { %>
              <li>
                <a href="/shop?category=<%= category._id %>" 
                   class="<%= query.category === category._id.toString() ? 'text-blue-600 font-medium' : 'hover:text-blue-600' %>">
                  <%= category.name %>
                </a>
              </li>
            <% }); %>
          </ul>
        </div>

        <div>
          <h3 class="font-semibold mb-2">TAGS</h3>
          <div class="flex flex-wrap gap-2 text-sm text-gray-500">
            <span class="bg-gray-200 px-2 py-1 rounded">DSLR</span>
            <span class="bg-gray-200 px-2 py-1 rounded">Canon</span>
            <span class="bg-gray-200 px-2 py-1 rounded">Sony</span>
            <span class="bg-gray-200 px-2 py-1 rounded">iPhone</span>
          </div>
        </div>

        <div>
          <h3 class="font-semibold mb-2">FILTER BY PRICE</h3>
          <p class="text-sm text-gray-600">$0 - $5000</p>
        </div>
      </aside>

      <!-- Product Grid -->
      <div class="col-span-3">
        <div class="flex justify-between items-center mb-4">
          <p class="text-sm text-gray-600">
            Showing <%= (currentPage - 1) * limit + 1 %>â€“<%= Math.min(currentPage * limit, total) %> of <%= total %> results
            <% if (query.category) { %>
              <% const selectedCategory = categories.find(cat => cat._id.toString() === query.category) %>
              <% if (selectedCategory) { %>
                in <span class="font-medium"><%= selectedCategory.name %></span>
              <% } %>
            <% } %>
          </p>
          <form action="/shop" method="GET" class="flex gap-2">
            <% if (query.category) { %>
              <input type="hidden" name="category" value="<%= query.category %>" />
            <% } %>
            <input
              type="text"
              name="search"
              placeholder="Search..."
              value="<%= query.search || '' %>"
              class="border px-3 py-1 text-sm rounded"
            />
            <button type="submit" class="bg-blue-600 text-white px-3 py-1 text-sm rounded hover:bg-blue-700">
              Search
            </button>
          </form>
        </div>

        <% if (products.length === 0) { %>
          <div class="text-center py-12">
            <p class="text-gray-500 text-lg">No products found.</p>
            <% if (query.category || query.search) { %>
              <a href="/shop" class="text-blue-600 hover:underline mt-2 inline-block">Clear filters</a>
            <% } %>
          </div>
        <% } else { %>
          <div class="grid grid-cols-3 gap-6">
            <% products.forEach(product => { %>
              <div class="bg-white shadow p-2 hover:shadow-lg transition-shadow cursor-pointer" onclick="window.location.href='/product/<%= product._id %>'">
                <img src="<%= product.images && product.images[0] ? product.images[0] : '/images/placeholder.jpg' %>" 
                     alt="<%= product.name %>" 
                     class="w-full h-64 object-cover" />
                <h4 class="mt-2 font-semibold text-sm"><%= product.name %></h4>
                <p class="<%= product.discounted ? 'line-through text-gray-400' : 'text-green-600' %> text-sm">
                  $<%= product.price %>
                </p>
                <% if (product.discounted) { %>
                  <p class="text-green-600 text-sm">$<%= product.discountPrice %></p>
                <% } %>
              </div>
            <% }); %>
          </div>

          <!-- Pagination -->
          <% if (total > limit) { %>
            <div class="flex justify-center mt-10 space-x-2 text-gray-500">
              <% if (currentPage > 1) { %>
                <a href="/shop?page=<%= currentPage - 1 %><%= query.category ? '&category=' + query.category : '' %><%= query.search ? '&search=' + query.search : '' %>" 
                   class="hover:text-black">&laquo;</a>
              <% } %>
              
              <% for (let i = 1; i <= Math.ceil(total / limit); i++) { %>
                <a href="/shop?page=<%= i %><%= query.category ? '&category=' + query.category : '' %><%= query.search ? '&search=' + query.search : '' %>" 
                   class="<%= currentPage === i ? 'font-semibold text-black' : 'hover:text-black' %>"><%= i %></a>
              <% } %>
              
              <% if (currentPage < Math.ceil(total / limit)) { %>
                <a href="/shop?page=<%= currentPage + 1 %><%= query.category ? '&category=' + query.category : '' %><%= query.search ? '&search=' + query.search : '' %>" 
                   class="hover:text-black">&raquo;</a>
              <% } %>
            </div>
          <% } %>
        <% } %>
      </div>
    </div>

    <!-- Subscribe Section -->
    <section class="bg-black text-white py-12 mt-20">
      <div class="container mx-auto px-6 text-center">
        <h3 class="text-xl font-medium mb-4">SUBSCRIBE US NOW</h3>
        <p class="text-sm mb-6">Get updates for latest cameras and lenses</p>
        <div class="max-w-xl mx-auto flex">
          <input
            type="email"
            placeholder="Your email address"
            class="flex-1 px-4 py-2 text-black"
          />
          <button class="bg-gray-800 px-6 py-2">Subscribe</button>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="bg-white py-12 border-t mt-20">
      <div class="container mx-auto px-6 grid grid-cols-4 gap-10 text-sm text-gray-600">
        <div>
          <img src="/footer-image.jpg" alt="Camera" class="mb-4" />
          <p>&copy; CaptureCore 2025</p>
        </div>
        <div>
          <h4 class="font-semibold mb-3">QUICK LINKS</h4>
          <ul class="space-y-2">
            <li><a href="/shop">Shop</a></li>
            <li><a href="/about">About</a></li>
            <li><a href="/contact">Contact</a></li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold mb-3">HELP & INFO</h4>
          <ul class="space-y-2">
            <li><a href="#">Terms & Conditions</a></li>
            <li><a href="#">Privacy Policy</a></li>
            <li><a href="#">FAQs</a></li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold mb-3">CONTACT US</h4>
          <p>Email: support@capturecore.com</p>
          <p>Phone: +91 9123456789</p>
        </div>
      </div>
    </footer>
  </body>
</html>
