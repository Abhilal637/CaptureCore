<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Addresses | CaptureCore</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="/css/user/styles.css">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white font-sans">
  <%- include('../partial/user/navbar') %>

  <%- include('../partial/user/profilesidebar') %>

  <!-- Profile Content -->
  <main class="flex-1">
    <div class="bg-gray-50 shadow rounded p-10">
      <!-- Header -->
      <div class="flex items-center justify-between mb-6">
        <h1 class="text-2xl font-semibold text-gray-800">My Addresses</h1>
        <a href="/addresses/add" class="inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded hover:bg-indigo-700">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m6-6H6" />
          </svg>
          Add Address
        </a>
      </div>

      <!-- Success Messages -->
      <% if (typeof success !== 'undefined' && success === 'address_added') { %>
        <div class="mb-4 bg-green-100 text-green-700 px-4 py-2 rounded">
          Address added successfully!
        </div>
      <% } %>

      <!-- Error Messages -->
      <% if (typeof error !== 'undefined' && error) { %>
        <div class="mb-4 bg-red-100 text-red-700 px-4 py-2 rounded">
          <%= error %>
        </div>
      <% } %>

      <% if (typeof addresses !== 'undefined' && addresses && addresses.length > 0) { %>
        <div class="grid gap-6 md:grid-cols-2">
          <% addresses.forEach(address => { %>
            <div class="border rounded-lg p-5 shadow-sm hover:shadow-md transition bg-white">
              
              <!-- Address Info + Default Badge/Button -->
              <div class="flex justify-between items-start mb-3">
                <div>
                  <h2 class="text-lg font-semibold text-gray-800"><%= address.fullName %></h2>
                  <p class="text-sm text-gray-600 leading-tight">
                    <%= address.addressLine %><br>
                    <%= address.city %>, <%= address.state %> - <%= address.pincode %><br>
                    <%= address.country %><br>
                    Phone: <%= address.phone %>
                  </p>
                </div>
      
                <!-- Default Label or Make Default Button -->
                <div class="ml-4">
                  <% if (address.isDefault) { %>
                    <span class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full font-medium">Default</span>
                  <% } else { %>
                    <form action="/addresses/default/<%= address._id %>" method="POST">
                      <button type="submit" class="text-xs text-blue-600 underline hover:text-blue-800">
                        Make Default
                      </button>
                    </form>
                  <% } %>
                </div>
              </div>
      
              <!-- Action Buttons -->
              <div class="flex space-x-4 mt-2">
                <a href="/addresses/edit/<%= address._id %>" class="text-sm text-indigo-600 hover:underline">Edit</a>
                <form action="/addresses/delete/<%= address._id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this address?')">
                  <button type="submit" class="text-sm text-red-600 hover:underline">Delete</button>
                </form>
              </div>
      
            </div>
          <% }) %>
        </div>
      <% } %>
      
  </main>
</body>
</html>
